{"version":3,"sources":["media/plugin.js"],"names":["eq","call","id","global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","apply","this","noop","constant","value","never","always","none","NONE","o","isNone","fold","_s","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","a","constant_a","self","me","f","v","elementEq","b","Optional","from","isType","type","x","Array","isPrototypeOf","constructor","name","String","isString","isObject","isArray","isNonNullable","isNullable","nativePush","push","xs","len","flatten","r","Cell","initial","get","set","keys","each$1","obj","props","k","pred","onTrue","onFalse","internalFilter","key","has","getScripts","editor","getParam","hasLiveEmbeds","global$1","global$2","global$3","getVideoScriptMatch","prefixes","src","indexOf","DOM","trimPx","replace","htmlToData","html","isEphoxEmbed","data","validate","allow_conditional_comments","start","attrs","style","styles","parseStyle","source","altsource","poster","width","height","getEphoxEmbedData","movie","extend","videoScript","parse","guess","url","mime","mp3","m4a","wav","mp4","webm","ogg","swf","toLowerCase","split","pop","global$4","global$5","DOM$1","addPx","test","setAttributes","updatedAttrs","val","attr","splice","sources","updateHtml","updateAll","hasImage","writer","sourceCount","comment","text","cdata","raw","empty","styleMap","serializeStyle","updateEphoxEmbed","end","index","imgAttrs","getContent","urlPatterns","regex","w","h","allowFullscreen","getUrl","pattern","protocol","protocolMatches","match","getProtocol","exec","newUrl","_loop_1","dataToHtml","dataIn","embed","convertURL","sourcemime","altsourcemime","patterns","allowfullscreen","audioTemplateCallback","getAudioTemplateCallback","videoTemplateCallback","getVideoTemplateCallback","dom","encode","getIframeHtml","getFlashHtml","getAudioHtml","getScriptHtml","getVideoHtml","global$6","cache","loadedData","getEmbedHtml","embedHandler","getUrlResolver","handler","res","rej","wrappedResolve","response","embedPromise","defaultPromise","extractMeta","sourceInput","mainData","getValue","metaData","prop","_a","getFromData","getFromMetaData","getNonEmptyValue","c","child","getDimensions","dimensions","dims","unwrap","wrap","wrapped","handleError","error","errorMessage","notificationManager","open","snippetToData","embedSnippet","addEmbedHtml","api","trim","snippetData","nuData","setData","handleInsert","beforeObjects","select","insertContent","afterObjects","y","selection","selectPlaceholder","nodeChanged","submitForm","prevData","newData","then","catch","showDialog","editorData","element","getNode","snippet","getAttribute","isMediaElement","serializer","serialize","getEditorData","currentData","initialData","sizeInput","hasDimensions","label","constrain","generalTab","title","items","filetype","embedTab","advancedFormItems","hasAltSource","hasPoster","advancedTab","tabs","body","win","windowManager","size","buttons","primary","onSubmit","serviceData","getData","close","onChange","detail","handleSource","dataFromEmbed","handleEmbed","handleUpdate","global$7","global$8","global$9","sanitize","shouldFilterHtml","blocked","attrName","isLiveEmbedNode","node","getDimension","dimension","defaultValue","setDimensions","previewNode","useDefaults","defaultWidth","fallbackHeight","defaultHeight","createPlaceholderNode","placeHolder","shortEnded","retainAttributesAndInnerHtml","transparentSrc","data-mce-object","class","createPreviewNode","filteredStyles","previewWrapper","contentEditable","frameborder","sanitizedHtml","nodeName","newNode","forced_root_block","schema","context","firstChild","append","appendNodeContent","shimNode","sourceNode","targetNode","attribs","attributes","ai","attrValue","innerHtml","escape","isPageEmbedWrapper","nodeClass","isWithinEmbedWrapper","parent","setup","on","specialElements","getSpecialElements","RegExp","boolAttrs","getBoolAttrs","parser","addNodeFilter","nodes","ceFalse","placeHolderConverter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","unescape","$","elm","$elm","find","stateSelectorAdapter","selector","buttonApi","selectorChangedWithUnbind","join","setActive","unbind","add","addCommand","register","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addMenuItem","register$1","e","target","nodeType","setup$1","selectedNode","hasClass","getAttrib","setAttribute","preventDefault","setup$2","get$1"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.7.0 (2021-02-10)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n\n    var nativePush = Array.prototype.push;\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n    var objAcc = function (r) {\n      return function (x, i) {\n        r[i] = x;\n      };\n    };\n    var internalFilter = function (obj, pred, onTrue, onFalse) {\n      var r = {};\n      each$1(obj, function (x, i) {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n      });\n      return r;\n    };\n    var filter = function (obj, pred) {\n      var t = {};\n      internalFilter(obj, pred, objAcc(t), noop);\n      return t;\n    };\n    var get = function (obj, key) {\n      return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n\n    var getScripts = function (editor) {\n      return editor.getParam('media_scripts');\n    };\n    var getAudioTemplateCallback = function (editor) {\n      return editor.getParam('audio_template_callback');\n    };\n    var getVideoTemplateCallback = function (editor) {\n      return editor.getParam('video_template_callback');\n    };\n    var hasLiveEmbeds = function (editor) {\n      return editor.getParam('media_live_embeds', true);\n    };\n    var shouldFilterHtml = function (editor) {\n      return editor.getParam('media_filter_html', true);\n    };\n    var getUrlResolver = function (editor) {\n      return editor.getParam('media_url_resolver');\n    };\n    var hasAltSource = function (editor) {\n      return editor.getParam('media_alt_source', true);\n    };\n    var hasPoster = function (editor) {\n      return editor.getParam('media_poster', true);\n    };\n    var hasDimensions = function (editor) {\n      return editor.getParam('media_dimensions', true);\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n    var getVideoScriptMatch = function (prefixes, src) {\n      if (prefixes) {\n        for (var i = 0; i < prefixes.length; i++) {\n          if (src.indexOf(prefixes[i].filter) !== -1) {\n            return prefixes[i];\n          }\n        }\n      }\n    };\n\n    var DOM = global$2.DOM;\n    var trimPx = function (value) {\n      return value.replace(/px$/, '');\n    };\n    var getEphoxEmbedData = function (attrs) {\n      var style = attrs.map.style;\n      var styles = style ? DOM.parseStyle(style) : {};\n      return {\n        type: 'ephox-embed-iri',\n        source: attrs.map['data-ephox-embed-iri'],\n        altsource: '',\n        poster: '',\n        width: get(styles, 'max-width').map(trimPx).getOr(''),\n        height: get(styles, 'max-height').map(trimPx).getOr('')\n      };\n    };\n    var htmlToData = function (prefixes, html) {\n      var isEphoxEmbed = Cell(false);\n      var data = {};\n      global$3({\n        validate: false,\n        allow_conditional_comments: true,\n        start: function (name, attrs) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            data = getEphoxEmbedData(attrs);\n          } else {\n            if (!data.source && name === 'param') {\n              data.source = attrs.map.movie;\n            }\n            if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n              if (!data.type) {\n                data.type = name;\n              }\n              data = global$1.extend(attrs.map, data);\n            }\n            if (name === 'script') {\n              var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n              if (!videoScript) {\n                return;\n              }\n              data = {\n                type: 'script',\n                source: attrs.map.src,\n                width: String(videoScript.width),\n                height: String(videoScript.height)\n              };\n            }\n            if (name === 'source') {\n              if (!data.source) {\n                data.source = attrs.map.src;\n              } else if (!data.altsource) {\n                data.altsource = attrs.map.src;\n              }\n            }\n            if (name === 'img' && !data.poster) {\n              data.poster = attrs.map.src;\n            }\n          }\n        }\n      }).parse(html);\n      data.source = data.source || data.src || data.data;\n      data.altsource = data.altsource || '';\n      data.poster = data.poster || '';\n      return data;\n    };\n\n    var guess = function (url) {\n      var mimes = {\n        mp3: 'audio/mpeg',\n        m4a: 'audio/x-m4a',\n        wav: 'audio/wav',\n        mp4: 'video/mp4',\n        webm: 'video/webm',\n        ogg: 'video/ogg',\n        swf: 'application/x-shockwave-flash'\n      };\n      var fileEnd = url.toLowerCase().split('.').pop();\n      var mime = mimes[fileEnd];\n      return mime ? mime : '';\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n\n    var DOM$1 = global$2.DOM;\n    var addPx = function (value) {\n      return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n    };\n    var setAttributes = function (attrs, updatedAttrs) {\n      each$1(updatedAttrs, function (val, name) {\n        var value = '' + val;\n        if (attrs.map[name]) {\n          var i = attrs.length;\n          while (i--) {\n            var attr = attrs[i];\n            if (attr.name === name) {\n              if (value) {\n                attrs.map[name] = value;\n                attr.value = value;\n              } else {\n                delete attrs.map[name];\n                attrs.splice(i, 1);\n              }\n            }\n          }\n        } else if (value) {\n          attrs.push({\n            name: name,\n            value: value\n          });\n          attrs.map[name] = value;\n        }\n      });\n    };\n    var updateEphoxEmbed = function (data, attrs) {\n      var style = attrs.map.style;\n      var styleMap = style ? DOM$1.parseStyle(style) : {};\n      styleMap['max-width'] = addPx(data.width);\n      styleMap['max-height'] = addPx(data.height);\n      setAttributes(attrs, { style: DOM$1.serializeStyle(styleMap) });\n    };\n    var sources = [\n      'source',\n      'altsource'\n    ];\n    var updateHtml = function (html, data, updateAll) {\n      var writer = global$5();\n      var isEphoxEmbed = Cell(false);\n      var sourceCount = 0;\n      var hasImage;\n      global$3({\n        validate: false,\n        allow_conditional_comments: true,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          if (isEphoxEmbed.get()) ; else if (has(attrs.map, 'data-ephox-embed-iri')) {\n            isEphoxEmbed.set(true);\n            updateEphoxEmbed(data, attrs);\n          } else {\n            switch (name) {\n            case 'video':\n            case 'object':\n            case 'embed':\n            case 'img':\n            case 'iframe':\n              if (data.height !== undefined && data.width !== undefined) {\n                setAttributes(attrs, {\n                  width: data.width,\n                  height: data.height\n                });\n              }\n              break;\n            }\n            if (updateAll) {\n              switch (name) {\n              case 'video':\n                setAttributes(attrs, {\n                  poster: data.poster,\n                  src: ''\n                });\n                if (data.altsource) {\n                  setAttributes(attrs, { src: '' });\n                }\n                break;\n              case 'iframe':\n                setAttributes(attrs, { src: data.source });\n                break;\n              case 'source':\n                if (sourceCount < 2) {\n                  setAttributes(attrs, {\n                    src: data[sources[sourceCount]],\n                    type: data[sources[sourceCount] + 'mime']\n                  });\n                  if (!data[sources[sourceCount]]) {\n                    return;\n                  }\n                }\n                sourceCount++;\n                break;\n              case 'img':\n                if (!data.poster) {\n                  return;\n                }\n                hasImage = true;\n                break;\n              }\n            }\n          }\n          writer.start(name, attrs, empty);\n        },\n        end: function (name) {\n          if (!isEphoxEmbed.get()) {\n            if (name === 'video' && updateAll) {\n              for (var index = 0; index < 2; index++) {\n                if (data[sources[index]]) {\n                  var attrs = [];\n                  attrs.map = {};\n                  if (sourceCount <= index) {\n                    setAttributes(attrs, {\n                      src: data[sources[index]],\n                      type: data[sources[index] + 'mime']\n                    });\n                    writer.start('source', attrs, true);\n                  }\n                }\n              }\n            }\n            if (data.poster && name === 'object' && updateAll && !hasImage) {\n              var imgAttrs = [];\n              imgAttrs.map = {};\n              setAttributes(imgAttrs, {\n                src: data.poster,\n                width: data.width,\n                height: data.height\n              });\n              writer.start('img', imgAttrs, true);\n            }\n          }\n          writer.end(name);\n        }\n      }, global$4({})).parse(html);\n      return writer.getContent();\n    };\n\n    var urlPatterns = [\n      {\n        regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$2?$4',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: 'www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'player.vimeo.com/video/$2?title=0&amp;byline=0',\n        allowFullscreen: true\n      },\n      {\n        regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: 'maps.google.com/maps/ms?msid=$2&output=embed\"',\n        allowFullscreen: false\n      },\n      {\n        regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /dai\\.ly\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: 'www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      }\n    ];\n    var getProtocol = function (url) {\n      var protocolMatches = url.match(/^(https?:\\/\\/|www\\.)(.+)$/i);\n      if (protocolMatches && protocolMatches.length > 1) {\n        return protocolMatches[1] === 'www.' ? 'https://' : protocolMatches[1];\n      } else {\n        return 'https://';\n      }\n    };\n    var getUrl = function (pattern, url) {\n      var protocol = getProtocol(url);\n      var match = pattern.regex.exec(url);\n      var newUrl = protocol + pattern.url;\n      var _loop_1 = function (i) {\n        newUrl = newUrl.replace('$' + i, function () {\n          return match[i] ? match[i] : '';\n        });\n      };\n      for (var i = 0; i < match.length; i++) {\n        _loop_1(i);\n      }\n      return newUrl.replace(/\\?$/, '');\n    };\n    var matchPattern = function (url) {\n      var patterns = urlPatterns.filter(function (pattern) {\n        return pattern.regex.test(url);\n      });\n      if (patterns.length > 0) {\n        return global$1.extend({}, patterns[0], { url: getUrl(patterns[0], url) });\n      } else {\n        return null;\n      }\n    };\n\n    var getIframeHtml = function (data) {\n      var allowFullscreen = data.allowfullscreen ? ' allowFullscreen=\"1\"' : '';\n      return '<iframe src=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n    };\n    var getFlashHtml = function (data) {\n      var html = '<object data=\"' + data.source + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n      if (data.poster) {\n        html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n      }\n      html += '</object>';\n      return html;\n    };\n    var getAudioHtml = function (data, audioTemplateCallback) {\n      if (audioTemplateCallback) {\n        return audioTemplateCallback(data);\n      } else {\n        return '<audio controls=\"controls\" src=\"' + data.source + '\">' + (data.altsource ? '\\n<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</audio>';\n      }\n    };\n    var getVideoHtml = function (data, videoTemplateCallback) {\n      if (videoTemplateCallback) {\n        return videoTemplateCallback(data);\n      } else {\n        return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source + '\"' + (data.sourcemime ? ' type=\"' + data.sourcemime + '\"' : '') + ' />\\n' + (data.altsource ? '<source src=\"' + data.altsource + '\"' + (data.altsourcemime ? ' type=\"' + data.altsourcemime + '\"' : '') + ' />\\n' : '') + '</video>';\n      }\n    };\n    var getScriptHtml = function (data) {\n      return '<script src=\"' + data.source + '\"></script>';\n    };\n    var dataToHtml = function (editor, dataIn) {\n      var data = global$1.extend({}, dataIn);\n      if (!data.source) {\n        global$1.extend(data, htmlToData(getScripts(editor), data.embed));\n        if (!data.source) {\n          return '';\n        }\n      }\n      if (!data.altsource) {\n        data.altsource = '';\n      }\n      if (!data.poster) {\n        data.poster = '';\n      }\n      data.source = editor.convertURL(data.source, 'source');\n      data.altsource = editor.convertURL(data.altsource, 'source');\n      data.sourcemime = guess(data.source);\n      data.altsourcemime = guess(data.altsource);\n      data.poster = editor.convertURL(data.poster, 'poster');\n      var pattern = matchPattern(data.source);\n      if (pattern) {\n        data.source = pattern.url;\n        data.type = pattern.type;\n        data.allowfullscreen = pattern.allowFullscreen;\n        data.width = data.width || String(pattern.w);\n        data.height = data.height || String(pattern.h);\n      }\n      if (data.embed) {\n        return updateHtml(data.embed, data, true);\n      } else {\n        var videoScript = getVideoScriptMatch(getScripts(editor), data.source);\n        if (videoScript) {\n          data.type = 'script';\n          data.width = String(videoScript.width);\n          data.height = String(videoScript.height);\n        }\n        var audioTemplateCallback = getAudioTemplateCallback(editor);\n        var videoTemplateCallback = getVideoTemplateCallback(editor);\n        data.width = data.width || '300';\n        data.height = data.height || '150';\n        global$1.each(data, function (value, key) {\n          data[key] = editor.dom.encode('' + value);\n        });\n        if (data.type === 'iframe') {\n          return getIframeHtml(data);\n        } else if (data.sourcemime === 'application/x-shockwave-flash') {\n          return getFlashHtml(data);\n        } else if (data.sourcemime.indexOf('audio') !== -1) {\n          return getAudioHtml(data, audioTemplateCallback);\n        } else if (data.type === 'script') {\n          return getScriptHtml(data);\n        } else {\n          return getVideoHtml(data, videoTemplateCallback);\n        }\n      }\n    };\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var cache = {};\n    var embedPromise = function (data, dataToHtml, handler) {\n      return new global$6(function (res, rej) {\n        var wrappedResolve = function (response) {\n          if (response.html) {\n            cache[data.source] = response;\n          }\n          return res({\n            url: data.source,\n            html: response.html ? response.html : dataToHtml(data)\n          });\n        };\n        if (cache[data.source]) {\n          wrappedResolve(cache[data.source]);\n        } else {\n          handler({ url: data.source }, wrappedResolve, rej);\n        }\n      });\n    };\n    var defaultPromise = function (data, dataToHtml) {\n      return new global$6(function (res) {\n        res({\n          html: dataToHtml(data),\n          url: data.source\n        });\n      });\n    };\n    var loadedData = function (editor) {\n      return function (data) {\n        return dataToHtml(editor, data);\n      };\n    };\n    var getEmbedHtml = function (editor, data) {\n      var embedHandler = getUrlResolver(editor);\n      return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n    };\n    var isCached = function (url) {\n      return cache.hasOwnProperty(url);\n    };\n\n    var extractMeta = function (sourceInput, data) {\n      return get(data, sourceInput).bind(function (mainData) {\n        return get(mainData, 'meta');\n      });\n    };\n    var getValue = function (data, metaData, sourceInput) {\n      return function (prop) {\n        var _a;\n        var getFromData = function () {\n          return get(data, prop);\n        };\n        var getFromMetaData = function () {\n          return get(metaData, prop);\n        };\n        var getNonEmptyValue = function (c) {\n          return get(c, 'value').bind(function (v) {\n            return v.length > 0 ? Optional.some(v) : Optional.none();\n          });\n        };\n        var getFromValueFirst = function () {\n          return getFromData().bind(function (child) {\n            return isObject(child) ? getNonEmptyValue(child).orThunk(getFromMetaData) : getFromMetaData().orThunk(function () {\n              return Optional.from(child);\n            });\n          });\n        };\n        var getFromMetaFirst = function () {\n          return getFromMetaData().orThunk(function () {\n            return getFromData().bind(function (child) {\n              return isObject(child) ? getNonEmptyValue(child) : Optional.from(child);\n            });\n          });\n        };\n        return _a = {}, _a[prop] = (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr(''), _a;\n      };\n    };\n    var getDimensions = function (data, metaData) {\n      var dimensions = {};\n      get(data, 'dimensions').each(function (dims) {\n        each([\n          'width',\n          'height'\n        ], function (prop) {\n          get(metaData, prop).orThunk(function () {\n            return get(dims, prop);\n          }).each(function (value) {\n            return dimensions[prop] = value;\n          });\n        });\n      });\n      return dimensions;\n    };\n    var unwrap = function (data, sourceInput) {\n      var metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\n      var get = getValue(data, metaData, sourceInput);\n      return __assign(__assign(__assign(__assign(__assign({}, get('source')), get('altsource')), get('poster')), get('embed')), getDimensions(data, metaData));\n    };\n    var wrap = function (data) {\n      var wrapped = __assign(__assign({}, data), {\n        source: { value: get(data, 'source').getOr('') },\n        altsource: { value: get(data, 'altsource').getOr('') },\n        poster: { value: get(data, 'poster').getOr('') }\n      });\n      each([\n        'width',\n        'height'\n      ], function (prop) {\n        get(data, prop).each(function (value) {\n          var dimensions = wrapped.dimensions || {};\n          dimensions[prop] = value;\n          wrapped.dimensions = dimensions;\n        });\n      });\n      return wrapped;\n    };\n    var handleError = function (editor) {\n      return function (error) {\n        var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n        editor.notificationManager.open({\n          type: 'error',\n          text: errorMessage\n        });\n      };\n    };\n    var snippetToData = function (editor, embedSnippet) {\n      return htmlToData(getScripts(editor), embedSnippet);\n    };\n    var isMediaElement = function (element) {\n      return element.getAttribute('data-mce-object') || element.getAttribute('data-ephox-embed-iri');\n    };\n    var getEditorData = function (editor) {\n      var element = editor.selection.getNode();\n      var snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\n      return __assign({ embed: snippet }, htmlToData(getScripts(editor), snippet));\n    };\n    var addEmbedHtml = function (api, editor) {\n      return function (response) {\n        if (isString(response.url) && response.url.trim().length > 0) {\n          var html = response.html;\n          var snippetData = snippetToData(editor, html);\n          var nuData = __assign(__assign({}, snippetData), {\n            source: response.url,\n            embed: html\n          });\n          api.setData(wrap(nuData));\n        }\n      };\n    };\n    var selectPlaceholder = function (editor, beforeObjects) {\n      var afterObjects = editor.dom.select('*[data-mce-object]');\n      for (var i = 0; i < beforeObjects.length; i++) {\n        for (var y = afterObjects.length - 1; y >= 0; y--) {\n          if (beforeObjects[i] === afterObjects[y]) {\n            afterObjects.splice(y, 1);\n          }\n        }\n      }\n      editor.selection.select(afterObjects[0]);\n    };\n    var handleInsert = function (editor, html) {\n      var beforeObjects = editor.dom.select('*[data-mce-object]');\n      editor.insertContent(html);\n      selectPlaceholder(editor, beforeObjects);\n      editor.nodeChanged();\n    };\n    var submitForm = function (prevData, newData, editor) {\n      newData.embed = updateHtml(newData.embed, newData);\n      if (newData.embed && (prevData.source === newData.source || isCached(newData.source))) {\n        handleInsert(editor, newData.embed);\n      } else {\n        getEmbedHtml(editor, newData).then(function (response) {\n          handleInsert(editor, response.html);\n        }).catch(handleError(editor));\n      }\n    };\n    var showDialog = function (editor) {\n      var editorData = getEditorData(editor);\n      var currentData = Cell(editorData);\n      var initialData = wrap(editorData);\n      var handleSource = function (prevData, api) {\n        var serviceData = unwrap(api.getData(), 'source');\n        if (prevData.source !== serviceData.source) {\n          addEmbedHtml(win, editor)({\n            url: serviceData.source,\n            html: ''\n          });\n          getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n        }\n      };\n      var handleEmbed = function (api) {\n        var data = unwrap(api.getData());\n        var dataFromEmbed = snippetToData(editor, data.embed);\n        api.setData(wrap(dataFromEmbed));\n      };\n      var handleUpdate = function (api, sourceInput) {\n        var data = unwrap(api.getData(), sourceInput);\n        var embed = dataToHtml(editor, data);\n        api.setData(wrap(__assign(__assign({}, data), { embed: embed })));\n      };\n      var mediaInput = [{\n          name: 'source',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Source'\n        }];\n      var sizeInput = !hasDimensions(editor) ? [] : [{\n          type: 'sizeinput',\n          name: 'dimensions',\n          label: 'Constrain proportions',\n          constrain: true\n        }];\n      var generalTab = {\n        title: 'General',\n        name: 'general',\n        items: flatten([\n          mediaInput,\n          sizeInput\n        ])\n      };\n      var embedTextarea = {\n        type: 'textarea',\n        name: 'embed',\n        label: 'Paste your embed code below:'\n      };\n      var embedTab = {\n        title: 'Embed',\n        items: [embedTextarea]\n      };\n      var advancedFormItems = [];\n      if (hasAltSource(editor)) {\n        advancedFormItems.push({\n          name: 'altsource',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Alternative source URL'\n        });\n      }\n      if (hasPoster(editor)) {\n        advancedFormItems.push({\n          name: 'poster',\n          type: 'urlinput',\n          filetype: 'image',\n          label: 'Media poster (Image URL)'\n        });\n      }\n      var advancedTab = {\n        title: 'Advanced',\n        name: 'advanced',\n        items: advancedFormItems\n      };\n      var tabs = [\n        generalTab,\n        embedTab\n      ];\n      if (advancedFormItems.length > 0) {\n        tabs.push(advancedTab);\n      }\n      var body = {\n        type: 'tabpanel',\n        tabs: tabs\n      };\n      var win = editor.windowManager.open({\n        title: 'Insert/Edit Media',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        onSubmit: function (api) {\n          var serviceData = unwrap(api.getData());\n          submitForm(currentData.get(), serviceData, editor);\n          api.close();\n        },\n        onChange: function (api, detail) {\n          switch (detail.name) {\n          case 'source':\n            handleSource(currentData.get(), api);\n            break;\n          case 'embed':\n            handleEmbed(api);\n            break;\n          case 'dimensions':\n          case 'altsource':\n          case 'poster':\n            handleUpdate(api, detail.name);\n            break;\n          }\n          currentData.set(unwrap(api.getData()));\n        },\n        initialData: initialData\n      });\n    };\n\n    var get$1 = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      return { showDialog: showDialog$1 };\n    };\n\n    var register = function (editor) {\n      var showDialog$1 = function () {\n        showDialog(editor);\n      };\n      editor.addCommand('mceMedia', showDialog$1);\n    };\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.html.Node');\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var global$9 = tinymce.util.Tools.resolve('tinymce.html.DomParser');\n\n    var sanitize = function (editor, html) {\n      if (shouldFilterHtml(editor) === false) {\n        return html;\n      }\n      var writer = global$5();\n      var blocked;\n      global$3({\n        validate: false,\n        allow_conditional_comments: false,\n        comment: function (text) {\n          if (!blocked) {\n            writer.comment(text);\n          }\n        },\n        cdata: function (text) {\n          if (!blocked) {\n            writer.cdata(text);\n          }\n        },\n        text: function (text, raw) {\n          if (!blocked) {\n            writer.text(text, raw);\n          }\n        },\n        start: function (name, attrs, empty) {\n          blocked = true;\n          if (name === 'script' || name === 'noscript' || name === 'svg') {\n            return;\n          }\n          for (var i = attrs.length - 1; i >= 0; i--) {\n            var attrName = attrs[i].name;\n            if (attrName.indexOf('on') === 0) {\n              delete attrs.map[attrName];\n              attrs.splice(i, 1);\n            }\n            if (attrName === 'style') {\n              attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n            }\n          }\n          writer.start(name, attrs, empty);\n          blocked = false;\n        },\n        end: function (name) {\n          if (blocked) {\n            return;\n          }\n          writer.end(name);\n        }\n      }, global$4({})).parse(html);\n      return writer.getContent();\n    };\n\n    var isLiveEmbedNode = function (node) {\n      var name = node.name;\n      return name === 'iframe' || name === 'video' || name === 'audio';\n    };\n    var getDimension = function (node, styles, dimension, defaultValue) {\n      if (defaultValue === void 0) {\n        defaultValue = null;\n      }\n      var value = node.attr(dimension);\n      if (isNonNullable(value)) {\n        return value;\n      } else if (!has(styles, dimension)) {\n        return defaultValue;\n      } else {\n        return null;\n      }\n    };\n    var setDimensions = function (node, previewNode, styles) {\n      var useDefaults = previewNode.name === 'img' || node.name === 'video';\n      var defaultWidth = useDefaults ? '300' : null;\n      var fallbackHeight = node.name === 'audio' ? '30' : '150';\n      var defaultHeight = useDefaults ? fallbackHeight : null;\n      previewNode.attr({\n        width: getDimension(node, styles, 'width', defaultWidth),\n        height: getDimension(node, styles, 'height', defaultHeight)\n      });\n    };\n    var appendNodeContent = function (editor, nodeName, previewNode, html) {\n      var newNode = global$9({\n        forced_root_block: false,\n        validate: false\n      }, editor.schema).parse(html, { context: nodeName });\n      while (newNode.firstChild) {\n        previewNode.append(newNode.firstChild);\n      }\n    };\n    var createPlaceholderNode = function (editor, node) {\n      var name = node.name;\n      var placeHolder = new global$7('img', 1);\n      placeHolder.shortEnded = true;\n      retainAttributesAndInnerHtml(editor, node, placeHolder);\n      setDimensions(node, placeHolder, {});\n      placeHolder.attr({\n        'style': node.attr('style'),\n        'src': global$8.transparentSrc,\n        'data-mce-object': name,\n        'class': 'mce-object mce-object-' + name\n      });\n      return placeHolder;\n    };\n    var createPreviewNode = function (editor, node) {\n      var name = node.name;\n      var styles = editor.dom.parseStyle(node.attr('style'));\n      var filteredStyles = filter(styles, function (value, key) {\n        return key !== 'width' && key !== 'height';\n      });\n      var previewWrapper = new global$7('span', 1);\n      previewWrapper.attr({\n        'contentEditable': 'false',\n        'style': editor.dom.serializeStyle(filteredStyles),\n        'data-mce-object': name,\n        'class': 'mce-preview-object mce-object-' + name\n      });\n      retainAttributesAndInnerHtml(editor, node, previewWrapper);\n      var previewNode = new global$7(name, 1);\n      setDimensions(node, previewNode, styles);\n      previewNode.attr({\n        src: node.attr('src'),\n        style: node.attr('style'),\n        class: node.attr('class')\n      });\n      if (name === 'iframe') {\n        previewNode.attr({\n          allowfullscreen: node.attr('allowfullscreen'),\n          frameborder: '0'\n        });\n      } else {\n        var attrs = [\n          'controls',\n          'crossorigin',\n          'currentTime',\n          'loop',\n          'muted',\n          'poster',\n          'preload'\n        ];\n        each(attrs, function (attrName) {\n          previewNode.attr(attrName, node.attr(attrName));\n        });\n        var sanitizedHtml = previewWrapper.attr('data-mce-html');\n        if (isNonNullable(sanitizedHtml)) {\n          appendNodeContent(editor, name, previewNode, sanitizedHtml);\n        }\n      }\n      var shimNode = new global$7('span', 1);\n      shimNode.attr('class', 'mce-shim');\n      previewWrapper.append(previewNode);\n      previewWrapper.append(shimNode);\n      return previewWrapper;\n    };\n    var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n      var attribs = sourceNode.attributes;\n      var ai = attribs.length;\n      while (ai--) {\n        var attrName = attribs[ai].name;\n        var attrValue = attribs[ai].value;\n        if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n          if (attrName === 'data' || attrName === 'src') {\n            attrValue = editor.convertURL(attrValue, attrName);\n          }\n          targetNode.attr('data-mce-p-' + attrName, attrValue);\n        }\n      }\n      var innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n      if (innerHtml) {\n        targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\n        targetNode.firstChild = null;\n      }\n    };\n    var isPageEmbedWrapper = function (node) {\n      var nodeClass = node.attr('class');\n      return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n    };\n    var isWithinEmbedWrapper = function (node) {\n      while (node = node.parent) {\n        if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var placeHolderConverter = function (editor) {\n      return function (nodes) {\n        var i = nodes.length;\n        var node;\n        var videoScript;\n        while (i--) {\n          node = nodes[i];\n          if (!node.parent) {\n            continue;\n          }\n          if (node.parent.attr('data-mce-object')) {\n            continue;\n          }\n          if (node.name === 'script') {\n            videoScript = getVideoScriptMatch(getScripts(editor), node.attr('src'));\n            if (!videoScript) {\n              continue;\n            }\n          }\n          if (videoScript) {\n            if (videoScript.width) {\n              node.attr('width', videoScript.width.toString());\n            }\n            if (videoScript.height) {\n              node.attr('height', videoScript.height.toString());\n            }\n          }\n          if (isLiveEmbedNode(node) && hasLiveEmbeds(editor) && global$8.ceFalse) {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPreviewNode(editor, node));\n            }\n          } else {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPlaceholderNode(editor, node));\n            }\n          }\n        }\n      };\n    };\n\n    var setup = function (editor) {\n      editor.on('preInit', function () {\n        var specialElements = editor.schema.getSpecialElements();\n        global$1.each('video audio iframe object'.split(' '), function (name) {\n          specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n        });\n        var boolAttrs = editor.schema.getBoolAttrs();\n        global$1.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n          boolAttrs[name] = {};\n        });\n        editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', placeHolderConverter(editor));\n        editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n          var i = nodes.length;\n          var node;\n          var realElm;\n          var ai;\n          var attribs;\n          var innerHtml;\n          var innerNode;\n          var realElmName;\n          var className;\n          while (i--) {\n            node = nodes[i];\n            if (!node.parent) {\n              continue;\n            }\n            realElmName = node.attr(name);\n            realElm = new global$7(realElmName, 1);\n            if (realElmName !== 'audio' && realElmName !== 'script') {\n              className = node.attr('class');\n              if (className && className.indexOf('mce-preview-object') !== -1) {\n                realElm.attr({\n                  width: node.firstChild.attr('width'),\n                  height: node.firstChild.attr('height')\n                });\n              } else {\n                realElm.attr({\n                  width: node.attr('width'),\n                  height: node.attr('height')\n                });\n              }\n            }\n            realElm.attr({ style: node.attr('style') });\n            attribs = node.attributes;\n            ai = attribs.length;\n            while (ai--) {\n              var attrName = attribs[ai].name;\n              if (attrName.indexOf('data-mce-p-') === 0) {\n                realElm.attr(attrName.substr(11), attribs[ai].value);\n              }\n            }\n            if (realElmName === 'script') {\n              realElm.attr('type', 'text/javascript');\n            }\n            innerHtml = node.attr('data-mce-html');\n            if (innerHtml) {\n              innerNode = new global$7('#text', 3);\n              innerNode.raw = true;\n              innerNode.value = sanitize(editor, unescape(innerHtml));\n              realElm.append(innerNode);\n            }\n            node.replace(realElm);\n          }\n        });\n      });\n      editor.on('SetContent', function () {\n        editor.$('span.mce-preview-object').each(function (index, elm) {\n          var $elm = editor.$(elm);\n          if ($elm.find('span.mce-shim').length === 0) {\n            $elm.append('<span class=\"mce-shim\"></span>');\n          }\n        });\n      });\n    };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        var name;\n        if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n          e.name = name;\n        }\n      });\n    };\n\n    var setup$2 = function (editor) {\n      editor.on('click keyup touchend', function () {\n        var selectedNode = editor.selection.getNode();\n        if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n          if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n            selectedNode.setAttribute('data-mce-selected', '2');\n          }\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        var objectType = e.target.getAttribute('data-mce-object');\n        if (objectType === 'script') {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var target = e.target;\n        var html;\n        if (target.getAttribute('data-mce-object')) {\n          html = target.getAttribute('data-mce-html');\n          if (html) {\n            html = unescape(html);\n            target.setAttribute('data-mce-html', escape(updateHtml(html, {\n              width: String(e.width),\n              height: String(e.height)\n            })));\n          }\n        }\n      });\n    };\n\n    var stateSelectorAdapter = function (editor, selector) {\n      return function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('media', {\n        tooltip: 'Insert/edit media',\n        icon: 'embed',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        },\n        onSetup: stateSelectorAdapter(editor, [\n          'img[data-mce-object]',\n          'span[data-mce-object]',\n          'div[data-ephox-embed-iri]'\n        ])\n      });\n      editor.ui.registry.addMenuItem('media', {\n        icon: 'embed',\n        text: 'Media...',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        }\n      });\n    };\n\n    function Plugin () {\n      global.add('media', function (editor) {\n        register(editor);\n        register$1(editor);\n        setup$1(editor);\n        setup(editor);\n        setup$2(editor);\n        return get$1(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}